;; gorilla-repl.fileformat = 1

;; **
;;; # Simple symbolic regression
;;; 
;;; This worksheet demonstrates how to run a symbolic regression with a basic tournament selection GA.
;; **

;; @@
(ns algebolic.demo.simple-sr
  (:require [gorilla-plot.core :as plot]
            [algebolic.expression.core :as expression]
            [algebolic.expression.genetics :as genetics]
            [algebolic.evolution.core :as evolution]
            [algebolic.evolution.metrics :as metrics]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
(def run-config
  (let [functions expression/function-symbols
        terminals (expression/make-terminals '[x])]
    {:initial-zeitgeist      {:rabble (genetics/make-initial-population functions terminals 3 5)}
     :elite-selector         (fn [rabble elite] elite)
     :mating-pool-selector   (fn [rabble elite] rabble)
     :reproduction-config    {:selector identity
                              :operations [[identity 10] [identity 20]]}
     :score-update           identity
     :metric-update-function metrics/update-age
     :stopping-condition     #(> (:age %) 10)
     :reporting-function     identity
     :checkpoint-function    #(println "checkpoint!")}))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;algebolic.demo.simple-sr/run-config</span>","value":"#'algebolic.demo.simple-sr/run-config"}
;; <=

;; @@
run-config
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:stopping-condition</span>","value":":stopping-condition"},{"type":"html","content":"<span class='clj-unkown'>#&lt;simple_sr$fn__6792$fn__6793 algebolic.demo.simple_sr$fn__6792$fn__6793@43835ea8&gt;</span>","value":"#<simple_sr$fn__6792$fn__6793 algebolic.demo.simple_sr$fn__6792$fn__6793@43835ea8>"}],"value":"[:stopping-condition #<simple_sr$fn__6792$fn__6793 algebolic.demo.simple_sr$fn__6792$fn__6793@43835ea8>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:elite-selector</span>","value":":elite-selector"},{"type":"html","content":"<span class='clj-unkown'>#&lt;simple_sr$fn__6792$fn__6795 algebolic.demo.simple_sr$fn__6792$fn__6795@2764abb9&gt;</span>","value":"#<simple_sr$fn__6792$fn__6795 algebolic.demo.simple_sr$fn__6792$fn__6795@2764abb9>"}],"value":"[:elite-selector #<simple_sr$fn__6792$fn__6795 algebolic.demo.simple_sr$fn__6792$fn__6795@2764abb9>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:checkpoint-function</span>","value":":checkpoint-function"},{"type":"html","content":"<span class='clj-unkown'>#&lt;simple_sr$fn__6792$fn__6797 algebolic.demo.simple_sr$fn__6792$fn__6797@76d353&gt;</span>","value":"#<simple_sr$fn__6792$fn__6797 algebolic.demo.simple_sr$fn__6792$fn__6797@76d353>"}],"value":"[:checkpoint-function #<simple_sr$fn__6792$fn__6797 algebolic.demo.simple_sr$fn__6792$fn__6797@76d353>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:score-update</span>","value":":score-update"},{"type":"html","content":"<span class='clj-unkown'>#&lt;core$identity clojure.core$identity@6f6ffcff&gt;</span>","value":"#<core$identity clojure.core$identity@6f6ffcff>"}],"value":"[:score-update #<core$identity clojure.core$identity@6f6ffcff>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:reproduction-config</span>","value":":reproduction-config"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:selector</span>","value":":selector"},{"type":"html","content":"<span class='clj-unkown'>#&lt;core$identity clojure.core$identity@6f6ffcff&gt;</span>","value":"#<core$identity clojure.core$identity@6f6ffcff>"}],"value":"[:selector #<core$identity clojure.core$identity@6f6ffcff>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:operations</span>","value":":operations"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>#&lt;core$identity clojure.core$identity@6f6ffcff&gt;</span>","value":"#<core$identity clojure.core$identity@6f6ffcff>"},{"type":"html","content":"<span class='clj-long'>10</span>","value":"10"}],"value":"[#<core$identity clojure.core$identity@6f6ffcff> 10]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>#&lt;core$identity clojure.core$identity@6f6ffcff&gt;</span>","value":"#<core$identity clojure.core$identity@6f6ffcff>"},{"type":"html","content":"<span class='clj-long'>20</span>","value":"20"}],"value":"[#<core$identity clojure.core$identity@6f6ffcff> 20]"}],"value":"[[#<core$identity clojure.core$identity@6f6ffcff> 10] [#<core$identity clojure.core$identity@6f6ffcff> 20]]"}],"value":"[:operations [[#<core$identity clojure.core$identity@6f6ffcff> 10] [#<core$identity clojure.core$identity@6f6ffcff> 20]]]"}],"value":"{:selector #<core$identity clojure.core$identity@6f6ffcff>, :operations [[#<core$identity clojure.core$identity@6f6ffcff> 10] [#<core$identity clojure.core$identity@6f6ffcff> 20]]}"}],"value":"[:reproduction-config {:selector #<core$identity clojure.core$identity@6f6ffcff>, :operations [[#<core$identity clojure.core$identity@6f6ffcff> 10] [#<core$identity clojure.core$identity@6f6ffcff> 20]]}]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:reporting-function</span>","value":":reporting-function"},{"type":"html","content":"<span class='clj-unkown'>#&lt;core$identity clojure.core$identity@6f6ffcff&gt;</span>","value":"#<core$identity clojure.core$identity@6f6ffcff>"}],"value":"[:reporting-function #<core$identity clojure.core$identity@6f6ffcff>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:initial-zeitgeist</span>","value":":initial-zeitgeist"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:rabble</span>","value":":rabble"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:expression</span>","value":":expression"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sin</span>","value":":sin"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:div</span>","value":":div"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:div</span>","value":":div"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:times</span>","value":":times"},{"type":"html","content":"<span class='clj-keyword'>:algebolic.expression.core/constant</span>","value":":algebolic.expression.core/constant"},{"type":"html","content":"<span class='clj-symbol'>x</span>","value":"x"}],"value":"(:times :algebolic.expression.core/constant x)"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:cos</span>","value":":cos"},{"type":"html","content":"<span class='clj-keyword'>:algebolic.expression.core/constant</span>","value":":algebolic.expression.core/constant"}],"value":"(:cos :algebolic.expression.core/constant)"}],"value":"(:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant))"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:cos</span>","value":":cos"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:div</span>","value":":div"},{"type":"html","content":"<span class='clj-keyword'>:algebolic.expression.core/constant</span>","value":":algebolic.expression.core/constant"},{"type":"html","content":"<span class='clj-keyword'>:algebolic.expression.core/constant</span>","value":":algebolic.expression.core/constant"}],"value":"(:div :algebolic.expression.core/constant :algebolic.expression.core/constant)"}],"value":"(:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))"}],"value":"(:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant)))"}],"value":"(:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))"}],"value":"[:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))]"}],"value":"{:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:expression</span>","value":":expression"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sin</span>","value":":sin"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:minus</span>","value":":minus"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:plus</span>","value":":plus"},{"type":"html","content":"<span class='clj-symbol'>x</span>","value":"x"},{"type":"html","content":"<span class='clj-keyword'>:algebolic.expression.core/constant</span>","value":":algebolic.expression.core/constant"}],"value":"(:plus x :algebolic.expression.core/constant)"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:div</span>","value":":div"},{"type":"html","content":"<span class='clj-symbol'>x</span>","value":"x"},{"type":"html","content":"<span class='clj-symbol'>x</span>","value":"x"}],"value":"(:div x x)"}],"value":"(:minus (:plus x :algebolic.expression.core/constant) (:div x x))"}],"value":"(:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))"}],"value":"[:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))]"}],"value":"{:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:expression</span>","value":":expression"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:plus</span>","value":":plus"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:div</span>","value":":div"},{"type":"html","content":"<span class='clj-symbol'>x</span>","value":"x"},{"type":"html","content":"<span class='clj-symbol'>x</span>","value":"x"}],"value":"(:div x x)"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:cos</span>","value":":cos"},{"type":"html","content":"<span class='clj-keyword'>:algebolic.expression.core/constant</span>","value":":algebolic.expression.core/constant"}],"value":"(:cos :algebolic.expression.core/constant)"}],"value":"(:plus (:div x x) (:cos :algebolic.expression.core/constant))"}],"value":"[:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))]"}],"value":"{:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))}"}],"value":"({:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))} {:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))} {:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))})"}],"value":"[:rabble ({:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))} {:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))} {:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))})]"}],"value":"{:rabble ({:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))} {:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))} {:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))})}"}],"value":"[:initial-zeitgeist {:rabble ({:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))} {:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))} {:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))})}]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:metric-update-function</span>","value":":metric-update-function"},{"type":"html","content":"<span class='clj-unkown'>#&lt;metrics$update_age algebolic.evolution.metrics$update_age@7f5e1fb5&gt;</span>","value":"#<metrics$update_age algebolic.evolution.metrics$update_age@7f5e1fb5>"}],"value":"[:metric-update-function #<metrics$update_age algebolic.evolution.metrics$update_age@7f5e1fb5>]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mating-pool-selector</span>","value":":mating-pool-selector"},{"type":"html","content":"<span class='clj-unkown'>#&lt;simple_sr$fn__6792$fn__6799 algebolic.demo.simple_sr$fn__6792$fn__6799@2b37760d&gt;</span>","value":"#<simple_sr$fn__6792$fn__6799 algebolic.demo.simple_sr$fn__6792$fn__6799@2b37760d>"}],"value":"[:mating-pool-selector #<simple_sr$fn__6792$fn__6799 algebolic.demo.simple_sr$fn__6792$fn__6799@2b37760d>]"}],"value":"{:stopping-condition #<simple_sr$fn__6792$fn__6793 algebolic.demo.simple_sr$fn__6792$fn__6793@43835ea8>, :elite-selector #<simple_sr$fn__6792$fn__6795 algebolic.demo.simple_sr$fn__6792$fn__6795@2764abb9>, :checkpoint-function #<simple_sr$fn__6792$fn__6797 algebolic.demo.simple_sr$fn__6792$fn__6797@76d353>, :score-update #<core$identity clojure.core$identity@6f6ffcff>, :reproduction-config {:selector #<core$identity clojure.core$identity@6f6ffcff>, :operations [[#<core$identity clojure.core$identity@6f6ffcff> 10] [#<core$identity clojure.core$identity@6f6ffcff> 20]]}, :reporting-function #<core$identity clojure.core$identity@6f6ffcff>, :initial-zeitgeist {:rabble ({:expression (:sin (:div (:div (:times :algebolic.expression.core/constant x) (:cos :algebolic.expression.core/constant)) (:cos (:div :algebolic.expression.core/constant :algebolic.expression.core/constant))))} {:expression (:sin (:minus (:plus x :algebolic.expression.core/constant) (:div x x)))} {:expression (:plus (:div x x) (:cos :algebolic.expression.core/constant))})}, :metric-update-function #<metrics$update_age algebolic.evolution.metrics$update_age@7f5e1fb5>, :mating-pool-selector #<simple_sr$fn__6792$fn__6799 algebolic.demo.simple_sr$fn__6792$fn__6799@2b37760d>}"}
;; <=

;; @@
(evolution/evolve (:initial-zeitgeist run-config) run-config)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:age</span>","value":":age"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:age 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:elite</span>","value":":elite"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[],"value":"{}"}],"value":"[:elite {}]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:rabble</span>","value":":rabble"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[],"value":"()"}],"value":"[:rabble ()]"}],"value":"{:age 1, :elite {}, :rabble ()}"}
;; <=

;; @@

;; @@
